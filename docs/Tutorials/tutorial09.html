<!doctype html>
<html class="docs-version-0.92" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Scalismo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Scalismo Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Shape completion using GP regression | Scalismo</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://scalismo.org/docs/Tutorials/tutorial09"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="0.92"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-0.92"><meta data-react-helmet="true" property="og:title" content="Shape completion using GP regression | Scalismo"><meta data-react-helmet="true" name="description" content="In this tutorial we will show how GP regression can be used to predict missing parts of a shape."><meta data-react-helmet="true" property="og:description" content="In this tutorial we will show how GP regression can be used to predict missing parts of a shape."><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://scalismo.org/docs/Tutorials/tutorial09"><link data-react-helmet="true" rel="alternate" href="https://scalismo.org/docs/Tutorials/tutorial09" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://scalismo.org/docs/Tutorials/tutorial09" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4461d896.css">
<link rel="preload" href="/assets/js/runtime~main.291114be.js" as="script">
<link rel="preload" href="/assets/js/main.b63e4727.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Scalismo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="Scalismo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Scalismo</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/onlinecourse">Online courses</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/support">Support</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/unibas-gravis/scalismo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs">0.92</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/Tutorials/tutorial09">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/Tutorials/tutorial09">0.92</a></li><li><a class="dropdown__link" href="/docs/0.91.0/Tutorials/tutorial09">0.91.0</a></li></ul></div><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Setup/ide">Setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/Tutorials/tutorial01">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial01">Hello Scalismo!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial02">Rigid Alignment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial03">From meshes to deformation fields</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial04">Gaussian processes and Point Distribution Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial05">Gaussian processes, sampling and marginalization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial06">Building a shape model from data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial07">Shape modelling with Gaussian processes and kernels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial08">Posterior shape models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Tutorials/tutorial09">Shape completion using GP regression</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial10">Iterative Closest Points for rigid alignment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial11">Model fitting with Iterative Closest Points</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial12">Parametric, non-rigid registration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial13">Active Shape Model Fitting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial14">Model fitting using MCMC - The basic framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Tutorials/tutorial15">Model fitting using MCMC - Fitting a shape model</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/scalismo-ui-introduction">Others</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->0.92</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Shape completion using GP regression</h1></header><p>In this tutorial we will show how GP regression can be used to predict missing parts of a shape.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="related-resources">Related resources<a class="hash-link" href="#related-resources" title="Direct link to heading">â€‹</a></h5><p>To enhance your understanding of this tutorial, we recommend the following resources from our <a href="https://shapemodelling.cs.unibas.ch/ssm-course/" target="_blank" rel="noopener noreferrer">online course</a>:</p><ul><li>Covariance functions <a href="https://shapemodelling.cs.unibas.ch/ssm-course/week4/step4-2" target="_blank" rel="noopener noreferrer">(Video)</a></li><li>Enlarging the flexibility of statistical shape models <a href="https://shapemodelling.cs.unibas.ch/ssm-course/week4/step4-7" target="_blank" rel="noopener noreferrer">(Article)</a></li><li>The regression problem <a href="https://shapemodelling.cs.unibas.ch/ssm-course/week5/step5-2" target="_blank" rel="noopener noreferrer">(Article)</a></li><li>Gaussian process regression <a href="https://shapemodelling.cs.unibas.ch/ssm-course/week5/step5-3" target="_blank" rel="noopener noreferrer">(Video)</a></li><li>Posterior models for different kernels <a href="https://shapemodelling.cs.unibas.ch/ssm-course/week5/step5-4" target="_blank" rel="noopener noreferrer">(Article)</a></li></ul><p>To run the code from this tutorial, download the following Scala file:</p><ul><li><a target="_blank" href="/assets/files/Tutorial09-ec0db7ad4d165cffa6e10d28e3baab74.scala">Tutorial09.scala</a></li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="preparation">Preparation<a class="hash-link" href="#preparation" title="Direct link to heading">â€‹</a></h5><p>As in the previous tutorials, we start by importing some commonly used objects and initializing the system.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.geometry.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.common.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.common.interpolation.TriangleMeshInterpolator3D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.mesh.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.io.{StatisticalModelIO, MeshIO, LandmarkIO}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.statisticalmodel.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.numerics.UniformMeshSampler3D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.kernels.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import breeze.linalg.{DenseMatrix, DenseVector}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.ui.api.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scalismo.utils.Random.FixedSeed.randBasis</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  scalismo.initialize()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val ui = ScalismoUI()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We also load a dataset that we want to reconstruct. In this case, it&#x27;s a face without nose:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  val noseless = MeshIO.readMesh(File(&quot;datasets/noseless.ply&quot;)).get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val targetGroup = ui.createGroup(&quot;target&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ui.show(targetGroup, noseless,&quot;noseless&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Finally, we also load the face model.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  val smallModel = StatisticalModelIO.readStatisticalTriangleMeshModel3D(File(&quot;datasets/model.h5&quot;)).get</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="enlarging-the-flexibility-of-a-shape-model">Enlarging the flexibility of a shape model<a class="hash-link" href="#enlarging-the-flexibility-of-a-shape-model" title="Direct link to heading">â€‹</a></h2><p>The model, which we just loaded, was built from only a small dataset. Therefore, the chances that it manages to
reconstruct the missing nose properly are rather slim.</p><p>To augment the shape variability of the model, we introduce some additional smooth shape deformations, modeled by a GP with a symmetric Gaussian kernel. This approach should be familiar from previous tutorials.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  val scalarValuedKernel = GaussianKernel3D(70, scaleFactor = 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case class XmirroredKernel(kernel: PDKernel[_3D]) extends PDKernel[_3D]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      override def domain = EuclideanSpace3D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      override def k(x: Point[_3D], y: Point[_3D]) = kernel(Point(x(0) * -1f, x(1), x(2)), y)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def symmetrizeKernel(kernel: PDKernel[_3D]): MatrixValuedPDKernel[_3D] = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val xmirrored = XmirroredKernel(kernel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val k1 = DiagonalKernel(kernel, 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val k2 = DiagonalKernel(xmirrored * -1f, xmirrored, xmirrored)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    k1 + k2  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val gp = GaussianProcess[_3D, EuclideanVector[_3D]](symmetrizeKernel(scalarValuedKernel))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val lowrankGP = LowRankGaussianProcess.approximateGPCholesky(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        smallModel.reference,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        relativeTolerance = 0.5e-1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        interpolator = TriangleMeshInterpolator3D[EuclideanVector[_3D]]()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val model = PointDistributionModel.augmentModel(smallModel, lowrankGP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val modelGroup = ui.createGroup(&quot;face model&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val ssmView = ui.show(modelGroup, model, &quot;model&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The mew model should now possess greater flexibility while still preserving the typical face-specific deformations.</p><p>It&#x27;s worth noting that this step is primarily motivated by the fact that we only have 10 face examples available to construct the model. However, even when sufficient data is available, it might still be beneficial to slightly increase the flexibility of a model before attempting to reconstruct missing parts. This affords the model some extra flexibility to account for bias in the data and explain minor shape variations that were not prominent in the dataset.</p><p>Equipped with our new model, we will perform the reconstruction in three steps:</p><ol><li>We&#x27;ll fit the face model to the given partial face using Gaussian process regression.</li><li>We&#x27;ll restrict the model to the nose part by marginalizing and then select a suitable nose shape.</li><li>We&#x27;ll choose a suitable nose from the model.</li></ol><p>As previously discussed, to perform GP regression, we need observations of the deformation vectors at certain points. In the next code, we&#x27;ll load and visualize some landmarks:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  val referenceLandmarks = LandmarkIO.readLandmarksJson3D(File(&quot;datasets/modelLandmarks.json&quot;)).get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val referencePoints : Seq[Point[_3D]] = referenceLandmarks.map(lm =&gt; lm.point)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val referenceLandmarkViews = referenceLandmarks.map(lm =&gt; ui.show(modelGroup, lm, s&quot;lm-${lm.id}&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val noselessLandmarks = LandmarkIO.readLandmarksJson3D(File(&quot;datasets/noselessLandmarks.json&quot;)).get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val noselessPoints : Seq[Point[_3D]] = noselessLandmarks.map(lm =&gt; lm.point)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val noselessLandmarkViews = noselessLandmarks.map(lm =&gt; ui.show(targetGroup, lm, s&quot;lm-${lm.id}&quot;))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>These correspondences define how each selected point of the
model should be deformed to its corresponding point on the target mesh.
In other words, we <strong>observed</strong> a few deformation vectors at
the selected model points. We use these deformation vectors and build
a deformation field:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  val domain = UnstructuredPointsDomain3D(referencePoints.toIndexedSeq)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val deformations = (0 until referencePoints.size).map(i =&gt; noselessPoints(i) - referencePoints(i) )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val defField = DiscreteField3D(domain, deformations)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ui.show(modelGroup, defField, &quot;partial_Field&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can now perform GP regression and retrieve the rest of the deformation field fitting our observations:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  val littleNoise = MultivariateNormalDistribution(DenseVector.zeros[Double](3), DenseMatrix.eye[Double](3) * 0.5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val regressionData = for ((refPoint, noselessPoint) &lt;- referencePoints zip noselessPoints) yield</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val refPointId = model.reference.pointSet.findClosestPoint(refPoint).id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (refPointId, noselessPoint, littleNoise)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val posterior = model.posterior(regressionData.toIndexedSeq)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val posteriorGroup = ui.createGroup(&quot;posterior-model&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ui.show(posteriorGroup, posterior, &quot;posterior&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/versioned_docs/version-0.92/Tutorials/tutorial09.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Tutorials/tutorial08"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Posterior shape models</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Tutorials/tutorial10"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Iterative Closest Points for rigid alignment</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enlarging-the-flexibility-of-a-shape-model" class="table-of-contents__link toc-highlight">Enlarging the flexibility of a shape model</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Tutorial</a></li><li class="footer__item"><a href="http://unibas-gravis.github.io/scalismo/latest/api/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">API-Doc</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://groups.google.com/g/scalismo" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitter.im/unibas-gravis/scalismo" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitter-Chat<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/unibas-gravis/scalismo" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 University of Basel. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.291114be.js"></script>
<script src="/assets/js/main.b63e4727.js"></script>
</body>
</html>