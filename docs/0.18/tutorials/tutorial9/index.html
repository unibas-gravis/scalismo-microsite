<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.68">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Shape completion using Gaussian process regression | Scalismo</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="0.18"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-0.18"><meta data-react-helmet="true" property="og:title" content="Shape completion using Gaussian process regression | Scalismo"><meta data-react-helmet="true" name="description" content="In this tutorial we will show how GP regression can be used to predict missing parts of a shape."><meta data-react-helmet="true" property="og:description" content="In this tutorial we will show how GP regression can be used to predict missing parts of a shape."><meta data-react-helmet="true" property="og:url" content="https://scalismo.org/docs/0.18/tutorials/tutorial9"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://scalismo.org/docs/0.18/tutorials/tutorial9"><link rel="stylesheet" href="/styles.656a0876.css">
<link rel="preload" href="/styles.0daa2ecb.js" as="script">
<link rel="preload" href="/runtime~main.efa23d19.js" as="script">
<link rel="preload" href="/main.0069e762.js" as="script">
<link rel="preload" href="/1.d0a04477.js" as="script">
<link rel="preload" href="/88.19909525.js" as="script">
<link rel="preload" href="/90.32728c13.js" as="script">
<link rel="preload" href="/7ca117c4.beb00885.js" as="script">
<link rel="preload" href="/87.bdda081e.js" as="script">
<link rel="preload" href="/0f202eb6.deb8427d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Scalismo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Scalismo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Scalismo</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/onlinecourse">Online courses</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/support">Support</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/unibas-gravis/scalismo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/docs/0.18/">0.18</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/tutorials/tutorial9">Next</a></li><li><a class="dropdown__link" href="/docs/tutorials/tutorial9">0.90</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.18/tutorials/tutorial9">0.18</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Scalismo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img alt="Scalismo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Scalismo</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/onlinecourse">Online courses</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/unibas-gravis/scalismo" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/support">Support</a></li><li class="menu__list-item"><a class="menu__link" href="/about">About</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/tutorials/tutorial9">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorials/tutorial9">0.90</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/0.18/tutorials/tutorial9">0.18</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial1">Hello Scalismo!</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial2">Rigid Alignment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial3">From meshes to deformation fields</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial4">Gaussian processes and Point Distribution Models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial5">Gaussian processes, sampling and marginalization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial6">Building a shape model from data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial7">Shape modelling with Gaussian processes and kernels</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial8">Posterior Shape Models</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/0.18/tutorials/tutorial9">Shape completion using Gaussian process regression</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial10">Iterative Closest Points for rigid alignment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial11">Model fitting with Iterative Closest Points</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial12">Parametric, non-rigid registration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial13">Active Shape Model fitting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial14">Model fitting using MCMC - The basic framework</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.18/tutorials/tutorial15">Model fitting using MCMC - Fitting a shape model</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Others</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.18/tutorials/scalismo-ui-introduction">Introduction to Scalismo-ui</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Scalismo <strong>0.18</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/tutorials/tutorial9">latest version</a></strong> (0.90).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 0.18</span></div><header><h1 class="docTitle_1Lrw">Shape completion using Gaussian process regression</h1></header><div class="markdown"><p>In this tutorial we will show how GP regression can be used to predict missing parts of a shape.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="preparation"></a>Preparation<a aria-hidden="true" class="hash-link" href="#preparation" title="Direct link to heading">#</a></h5><p>As in the previous tutorials, we start by importing some commonly used objects and initializing the system.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import scalismo.geometry._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import scalismo.common._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import scalismo.ui.api._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import scalismo.mesh._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import scalismo.io.{StatisticalModelIO, MeshIO, LandmarkIO}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import scalismo.statisticalmodel._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import scalismo.numerics.UniformMeshSampler3D</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import scalismo.kernels._</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import breeze.linalg.{DenseMatrix, DenseVector}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">scalismo.initialize()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">implicit val rng = scalismo.utils.Random(42)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val ui = ScalismoUI()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>We also load a dataset that we want to reconstruct. In this case, it is a face without nose:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val noseless = MeshIO.readMesh(new java.io.File(&quot;datasets/noseless.ply&quot;)).get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val targetGroup = ui.createGroup(&quot;target&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ui.show(targetGroup, noseless,&quot;noseless&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Finally, we also load the face model.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val smallModel = StatisticalModelIO.readStatisticalMeshModel(new java.io.File(&quot;datasets/model.h5&quot;)).get</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="enlarging-the-flexibility-of-a-shape-model"></a>Enlarging the flexibility of a shape model<a aria-hidden="true" class="hash-link" href="#enlarging-the-flexibility-of-a-shape-model" title="Direct link to heading">#</a></h2><p>The model, which we just loaded, was built from only a small dataset. Therefore, the chances that it manages to
reconstruct the missing nose properly are rather slim.</p><p>To increase the shape variability of the model, we add smooth some additional smooth shape deformations,
modelled by a GP with symmetric Gaussian kernel. The code should be familiar from the previous tutorials.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val scalarValuedKernel = GaussianKernel[_3D](70) * 10.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">case class XmirroredKernel(kernel : PDKernel[_3D]) extends PDKernel[_3D] {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override def domain = RealSpace[_3D]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override def k(x: Point[_3D], y: Point[_3D]) = kernel(Point(x(0) * -1f ,x(1), x(2)), y)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def symmetrizeKernel(kernel : PDKernel[_3D]) : MatrixValuedPDKernel[_3D] = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   val xmirrored = XmirroredKernel(kernel)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   val k1 = DiagonalKernel(kernel, 3)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   val k2 = DiagonalKernel(xmirrored * -1f, xmirrored, xmirrored)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   k1 + k2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val gp = GaussianProcess[_3D, EuclideanVector[_3D]](symmetrizeKernel(scalarValuedKernel))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val lowrankGP = LowRankGaussianProcess.approximateGPCholesky(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    smallModel.referenceMesh.pointSet,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    gp,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    relativeTolerance = 0.01,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    interpolator = NearestNeighborInterpolator())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val model = StatisticalMeshModel.augmentModel(smallModel, lowrankGP)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val modelGroup = ui.createGroup(&quot;face model&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val ssmView = ui.show(modelGroup, model, &quot;model&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>The new model should now contain much more flexibility, while still preserving the typical face-specific deformations.</p><p><em>Note: This step here is mainly motivated by the fact that we only have 10 face examples available to build the model. However,
even if sufficient data is available, it might still be a good idea to slighly enlarge the flexibility of a model
before attempting a reconstruction of missing parts. It gives the model some extra slack to account for
bias in the data and explain minor shape variations, which have not been prominent in the dataset</em>.</p><p>Equipped with our new model, we will perform the reconstruction in three steps:</p><ol><li>We fit the face model to the given partial face using Gaussian process regression.</li><li>We restrict the model to the nose part by marginalizing and select a suitable nose shape.</li><li>We choose a suitable nose from the model</li></ol><p>As we saw previously, to perform GP regression we need observations of the deformation vectors at some points.
We will discussed in <a href="/docs/0.18/tutorials/tutorial10">Tutorial 10</a> how such observations can be obtained fully automatically.
Here, we have done this already in a separate step and saved 200 corresponding points as landmarks, which we will now load and visualize:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val referenceLandmarks = LandmarkIO.readLandmarksJson[_3D](new java.io.File(&quot;datasets/modelLandmarks.json&quot;)).get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val referencePoints : Seq[Point[_3D]] = referenceLandmarks.map(lm =&gt; lm.point)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val referenceLandmarkViews = referenceLandmarks.map(lm =&gt; ui.show(modelGroup, lm, s&quot;lm-${lm.id}&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val noselessLandmarks = LandmarkIO.readLandmarksJson[_3D](new java.io.File(&quot;datasets/noselessLandmarks.json&quot;)).get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val noselessPoints : Seq[Point[_3D]] = noselessLandmarks.map(lm =&gt; lm.point)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val noselessLandmarkViews = noselessLandmarks.map(lm =&gt; ui.show(targetGroup, lm, s&quot;lm-${lm.id}&quot;))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>These correspondences define how each selected point of the
model should be deformed to its corresponding point on the target mesh.
In other words, we <strong>observed</strong> a few deformation vectors at
the selected model points. We use these deformation vectors and build
a deformation field:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val domain = UnstructuredPointsDomain(referencePoints.toIndexedSeq)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val deformations = (0 until referencePoints.size).map(i =&gt; noselessPoints(i) - referencePoints(i) )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val defField = DiscreteField[_3D, UnstructuredPointsDomain[_3D], EuclideanVector[_3D]](domain, deformations)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ui.show(modelGroup, defField, &quot;partial_Field&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>We can now perform GP regression and retrieve the rest of the deformations fitting our observations:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val littleNoise = MultivariateNormalDistribution(DenseVector.zeros[Double](3), DenseMatrix.eye[Double](3) * 0.5)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val regressionData = for ((refPoint, noselessPoint) &lt;- referencePoints zip noselessPoints) yield {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val refPointId = model.referenceMesh.pointSet.findClosestPoint(refPoint).id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    (refPointId, noselessPoint, littleNoise)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val posterior = model.posterior(regressionData.toIndexedSeq)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val posteriorGroup = ui.createGroup(&quot;posterior-model&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ui.show(posteriorGroup, posterior, &quot;posterior&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>With this posterior model, we get a normal distribution of faces satisfying our observations by having the selected characteristic points at the indicated positions.</p><p>Finally, as we are interested in the nose region only, we marginalize our posterior to obtain a posterior nose model as we did in a previous tutorial:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val nosePtIDs = model.referenceMesh.pointSet.pointIds.filter { id =&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (model.referenceMesh.pointSet.point(id) - model.referenceMesh.pointSet.point(PointId(8152))).norm &lt;= 42</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val posteriorNoseModel = posterior.marginal(nosePtIDs.toIndexedSeq)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val posteriorNoseGroup = ui.createGroup(&quot;posterior-nose-model&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ui.show(posteriorNoseGroup, posteriorNoseModel, &quot;posteriorNoseModel&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>We now have a probability distribution over fitting nose shapes. Our last
task is to select one nose as a reconstruction.  A simple and often
reasonable choice is to use the mean of this model, as this is the reconstruction
with the highest probability under the model.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-scala codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val bestReconstruction = posteriorNoseModel.mean</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Having a full posterior distribution
over fitting nose shapes gives us, however, much more freedom in choosing a
reconstruction. By introducing a utility function, which models the utility of each reconstruction for a given task,
we can use this distribution as the basis for decision making by minimizing the expected posterior loss.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/unibas-gravis/scalismo-microsite/edit/master/website/versioned_docs/version-0.18/tutorials/tutorial9.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/0.18/tutorials/tutorial8"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Posterior Shape Models</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/0.18/tutorials/tutorial10"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Iterative Closest Points for rigid alignment »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enlarging-the-flexibility-of-a-shape-model" class="table-of-contents__link">Enlarging the flexibility of a shape model</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Tutorial</a></li><li class="footer__item"><a href="http://unibas-gravis.github.io/scalismo/latest/api/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">API-Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://groups.google.com/g/scalismo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li><li class="footer__item"><a href="https://gitter.im/unibas-gravis/scalismo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter-Chat</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/unibas-gravis/scalismo" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021 University of Basel. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.0daa2ecb.js"></script>
<script src="/runtime~main.efa23d19.js"></script>
<script src="/main.0069e762.js"></script>
<script src="/1.d0a04477.js"></script>
<script src="/88.19909525.js"></script>
<script src="/90.32728c13.js"></script>
<script src="/7ca117c4.beb00885.js"></script>
<script src="/87.bdda081e.js"></script>
<script src="/0f202eb6.deb8427d.js"></script>
</body>
</html>